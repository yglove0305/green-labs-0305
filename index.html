<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>초록타자 3</title>
  <style>
    /* 1. 공통 및 배경 ---------------------------------------------------------------- */
html, body {
  min-height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Nanum Gothic', 'Segoe UI', 'Roboto', Arial, sans-serif;
  background: linear-gradient(120deg, #a8ffeb 0%, #fffbe7 100%);
  background-attachment: fixed;
  color: #20543a;
  letter-spacing: 0.02em;
  position: relative;
  overflow-x: hidden;
  scroll-behavior: smooth;
}
body {
  transition: background 0.7s, color 0.7s;
}
#background-particles {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 0;
  opacity: 0.17;
  filter: blur(1.5px);
}
body::before {
  content: "";
  position: fixed;
  top: -40vh; left: -40vw;
  width: 180vw; height: 180vh;
  background: radial-gradient(circle at 15% 25%, #00ffe4cc 0%, #ffffff00 67%) no-repeat;
  pointer-events: none;
  z-index: 0;
  opacity: 0.14;
}
body::after {
  content: "";
  position: fixed;
  bottom: -30vh; right: -30vw;
  width: 160vw; height: 160vh;
  background: radial-gradient(circle at 85% 95%, #ffe49944 0%, #ffffff00 80%) no-repeat;
  pointer-events: none;
  z-index: 0;
  opacity: 0.14;
}
/* 2. 인트로(로딩) 오버레이 ------------------------------------------------------- */
#intro-overlay {
  position: fixed; inset: 0;
  background: rgba(18, 34, 24, 0.97);
  z-index: 9999;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  animation: fadein 1.2s cubic-bezier(.41,.6,.32,1.06);
  transition: opacity 0.7s;
}
#intro-overlay.hide { opacity: 0; pointer-events: none; }
.intro-text {
  font-family: 'Orbitron', 'Nanum Gothic', sans-serif;
  font-size: 7rem; font-weight: 900;
  background: linear-gradient(90deg, #00ffbb 20%, #00d0ff 60%, #00ff99 100%);
  background-size: 400% 400%; background-clip: text;
  -webkit-background-clip: text;
  color: transparent; -webkit-text-fill-color: transparent;
  text-shadow: 0 2px 60px #00ffe4cc, 0 0 0 #fff;
  letter-spacing: 0.35em;
  animation: gradientMove 5s infinite linear alternate, neonGlow 2s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px #00ffe4bb);
}
@keyframes gradientMove {
  0% { background-position: 0% 80%; }
  100% { background-position: 100% 20%; }
}
@keyframes neonGlow {
  from { text-shadow: 0 0 30px #00ffd4, 0 0 60px #00ffbb33; }
  to { text-shadow: 0 0 80px #00ffd488, 0 0 180px #00ffbb55; }
}
.intro-loading {
  margin-top: 40px;
  font-size: 2.1rem;
  color: #4cffad;
  font-family: 'Orbitron', 'Courier New', monospace;
  text-shadow: 0 0 10px #00ffbb80;
  letter-spacing: 0.18em;
  opacity: 1;
  animation: blink 1s infinite;
}
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.45; }
}
@keyframes fadein { from { opacity: 0; } to { opacity: 1; } }

/* 3. 메인 컨테이너(글래스모피즘, 섀도우, 입체감) --------------------------------- */
#container {
  max-width: 1000px;
  margin: 48px auto 0 auto;
  background: rgba(255,255,255,0.86);
  border-radius: 40px;
  box-shadow: 0 16px 64px #00ffb72a, 0 2px 12px #00d0ff22, 0 0.5px 1.5px #fff;
  border: 2.5px solid #a7f2c8;
  padding: 54px 54px 40px 54px;
  position: relative;
  backdrop-filter: blur(10px) saturate(1.6);
  transition: background 0.4s, box-shadow 0.4s;
  z-index: 2;
  overflow: visible;
}
#container::before {
  content: "";
  position: absolute;
  inset: -22px;
  border-radius: 44px;
  z-index: -1;
  background: linear-gradient(90deg, #00e5bb75 0%, #fff0 70%);
  filter: blur(24px);
  pointer-events: none;
}

/* 4. 헤더(네온, 쉐도우, 카드배경) ----------------------------------------------- */
h1 {
  text-align: center;
  margin-bottom: 40px;
  font-family: 'Orbitron', 'Nanum Gothic', sans-serif;
  font-size: 4.2rem;
  letter-spacing: 0.14em;
  color: #08a76e;
  text-shadow: 0 4px 40px #00ffbb30, 0 1px 0 #fff, 0 0 3px #fff;
  font-weight: 900;
  border-radius: 19px;
  background: rgba(255,255,255,0.34);
  padding: 12px 0 14px 0;
  box-shadow: 0 3px 18px #00ffd41a;
}

/* 5. 설정 패널 (카드 스타일, 뉴모피즘, 그림자) ----------------------------------- */
#settings {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 24px;
  margin-bottom: 34px;
  flex-wrap: wrap;
  border-bottom: 2px solid #b8f7e2;
  padding-bottom: 22px;
  background: rgba(255,255,255,0.44);
  border-radius: 22px 22px 12px 12px;
  box-shadow: 0 3px 14px #a7f2c830;
  position: relative;
}
#settings > div {
  flex: 1 1 220px;
  margin-bottom: 11px;
  min-width: 160px;
  background: #f7fffa;
  padding: 10px 18px;
  border-radius: 13px;
  box-shadow: 0 2px 7px #a7f2c822;
  border: 1.2px solid #b2dfdb;
  transition: box-shadow 0.2s;
}
#settings > div:hover {
  box-shadow: 0 4px 18px #00ffd433;
}
label {
  margin-right: 14px;
  font-weight: 700;
  color: #24986b;
  letter-spacing: 0.03em;
  font-size: 1.19rem;
}
select {
  padding: 8px 22px;
  border-radius: 10px;
  border: 2px solid #b2dfdb;
  background: #e2fff5;
  font-size: 1.18rem;
  margin-left: 2px;
  font-weight: 700;
  transition: border 0.18s, box-shadow 0.22s;
  outline: none;
  box-shadow: 0 2px 9px #a7f2c830;
}
select:focus {
  border: 2.2px solid #31d989;
  box-shadow: 0 2px 20px #00ffd466;
}

/* 6. 샘플 문장 (카드/글래스/폰트 강조/미세그라데이션) ---------------------------- */
#sample-text {
  background: linear-gradient(90deg,#e0f2f1 78%, #cbf2e6 100%, #fff 120%);
  padding: 22px 32px;
  border-radius: 19px;
  font-size: 1.38rem;
  margin-bottom: 23px;
  line-height: 1.79;
  min-height: 104px;
  box-shadow: 0 4px 24px #b9f7e555,0 1px 4px #fff;
  border: 2px solid #b2dfdb;
  font-family: 'Nanum Gothic', Arial, sans-serif;
  letter-spacing: 0.05em;
  transition: background 0.3s, box-shadow 0.33s;
  user-select: none;
  overflow-x: auto;
  word-break: break-word;
}
#sample-text span {
  transition: background 0.18s, color 0.18s;
  border-radius: 3.5px;
  padding: 1px 3.5px;
  margin: 0 0.08em;
  font-size: 1em;
}
.highlight {
  background: linear-gradient(100deg, #ffcdd2 60%, #ffebee 100%) !important;
  color: #d32f2f !important;
  border-radius: 7px;
  font-weight: 700;
  box-shadow: 0 0 8px #ffbdbd55;
}
.fade-in {
  animation: fadeIn 0.55s cubic-bezier(.5,.3,.25,1.3);
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px);}
  to { opacity: 1; transform: none;}
}

/* 7. 진행 바 (네온/애니메이션/섀도우) --------------------------------------------- */
#progress-container {
  width: 100%;
  background: linear-gradient(90deg, #e8efe7 70%, #dcfbe7 100%);
  border-radius: 15px;
  overflow: hidden;
  margin-bottom: 22px;
  border: 2.2px solid #b9e4c9;
  height: 31px;
  box-shadow: 0 2px 12px #c7ffe766;
  position: relative;
}
#progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#22e3ad 10%,#00e88c 70%,#26d4b9 100%);
  text-align: center;
  line-height: 31px;
  color: #fff;
  font-weight: bold;
  letter-spacing: 0.06em;
  font-size: 1.18rem;
  box-shadow: 0 2px 16px #22e3ad44;
  border-radius: 13px 0 0 13px;
  transition: width 0.72s cubic-bezier(.7,.5,.2,1.3), background 0.33s;
  text-shadow: 0 1px 8px #22e3ad44;
  animation: progressShine 2s infinite linear;
}
@keyframes progressShine {
  0% { filter: brightness(1.04); }
  50% { filter: brightness(1.12) drop-shadow(0 0 8px #fff8);}
  100% { filter: brightness(1.04);}
}

/* 8. 타자 입력창 (글래스, 뉴모피즘, 포커스/에러/완료) ---------------------------- */
#typing-area {
  width: 100%;
  height: 120px;
  font-size: 1.38rem;
  padding: 22px 18px;
  border: 3px solid #a5d6a7;
  border-radius: 16px;
  margin-bottom: 27px;
  resize: none;
  font-family: 'Nanum Gothic', Arial, sans-serif;
  letter-spacing: 0.021em;
  background: linear-gradient(90deg, #f7fff7 80%, #e8fff4 100%);
  box-shadow: 0 3px 16px #00ffbb22 inset, 0 1px 8px #00e88c14;
  outline: none;
  transition: border 0.33s, box-shadow 0.33s, background 0.4s;
}
#typing-area:focus {
  border: 3px solid #00cca7;
  background: #f2fff5;
  box-shadow: 0 0 18px #bdf2e888, 0 0 0 #fff, 0 0 0 #fff;
}
#typing-area:disabled {
  filter: grayscale(0.2) brightness(0.92);
  background: #f8f8f8;
  opacity: 0.66;
}
#typing-area.error {
  border-color: #ff6767;
  background: #fff6f6;
  box-shadow: 0 0 16px #ffcdd2aa;
}

/* 9. 통계 패널 (카드/섀도우/애니메이션) ------------------------------------------- */
#stats {
  display: flex;
  justify-content: space-around;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 17px;
  padding: 17px 0 13px 0;
  border-bottom: 2px dashed #b6e7b5;
  background: rgba(255,255,255,0.30);
  border-radius: 11px;
  box-shadow: 0 2px 10px #b9f7e555;
}
#stats span {
  font-weight: 800;
  font-size: 1.28rem;
  margin: 5px 0;
  color: #098b4f;
  background: #dcffd6dd;
  border-radius: 11px;
  padding: 9px 28px;
  box-shadow: 0 3px 14px #b9f7e533;
  letter-spacing: 0.04em;
  min-width: 130px;
  display: inline-block;
  text-align: center;
  transition: background 0.3s, color 0.3s;
  position: relative;
  overflow: hidden;
}
#stats span::after {
  content: "";
  position: absolute; left: 0; bottom: 0;
  width: 100%; height: 4px;
  background: linear-gradient(90deg,#00ffd455 0%,#00ffd400 100%);
  opacity: 0.34;
}
#stats span.critical {
  color: #c32f2f; background: #ffe6e6;
  box-shadow: 0 0 12px #ffcdd2aa;
}

/* 10. 버튼 (네온/입체/호버/포커스/반응형) ---------------------------------------- */
button {
  padding: 14px 36px;
  background: linear-gradient(90deg,#22e3ad 60%,#00e88c 100%);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1.23rem;
  font-family: 'Nanum Gothic', Arial, sans-serif;
  margin-right: 16px;
  margin-bottom: 14px;
  font-weight: bold;
  box-shadow: 0 7px 24px #00ffbb33, 0 1.5px 7px #00ffd41d;
  letter-spacing: 0.03em;
  transition: background 0.22s, transform 0.17s, box-shadow 0.2s;
  position: relative;
  outline: none;
  border-bottom: 2.7px solid #11cfa1;
}
button:last-child { margin-right: 0; }
button:hover, button:focus {
  background: linear-gradient(90deg,#00cc99 0%,#00e88c 100%);
  transform: translateY(-3px) scale(1.045);
  box-shadow: 0 14px 36px #00ffd466;
  filter: brightness(1.08);
}
button:active {
  background: linear-gradient(90deg,#16b685 0%,#31d989 100%);
  filter: brightness(0.96);
}
button:disabled, button[disabled] {
  background: #b9e4c9cc;
  color: #7cbfa4;
  cursor: not-allowed;
  filter: grayscale(0.3) brightness(0.95);
}

/* 11. 토글(다크/라이트) --------------------------------------------------------- */
#toggle-mode {
  position: absolute;
  top: 30px;
  right: 46px;
  padding: 11px 28px;
  background: linear-gradient(90deg,#388e3c,#00bfae);
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1.19rem;
  font-weight: bold;
  box-shadow: 0 7px 24px #00ffd470;
  z-index: 4;
  transition: background 0.22s, color 0.22s;
}
#toggle-mode:hover { background: linear-gradient(90deg,#00bfae,#388e3c); }

/* 12. 리더보드, 기록, 차트 카드(입체/글래스/분리) ------------------------------- */
#leaderboard, #chart-container, #history {
  margin-top: 40px;
  padding-top: 27px;
  border-top: 2.5px solid #c8eadb;
  margin-bottom: 0;
  border-radius: 0 0 18px 18px;
  box-shadow: 0 4px 18px #00ffd41a;
  background: rgba(255,255,255,0.73);
  position: relative;
  min-height: 70px;
  margin-bottom: 24px;
}
#leaderboard h3, #chart-container h3, #history h3 {
  color: #008c61;
  font-family: 'Orbitron','Nanum Gothic',sans-serif;
  font-size: 1.43rem;
  margin-bottom: 13px;
  margin-top: 0;
  letter-spacing: 0.03em;
  font-weight: 900;
  text-shadow: 0 1px 0 #fff, 0 2px 5px #00ffd41a;
}
#leaderboard-list, #history-list {
  padding-left: 28px;
  margin-top: 0; margin-bottom: 0;
  font-size: 1.13rem;
  color: #2e7d32;
  list-style-type: decimal;
}
#leaderboard-list li, #history-list li {
  padding: 5px 0 5px 0;
  border-bottom: 1px dotted #c8eadb;
  margin-bottom: 3.5px;
  line-height: 1.62;
  transition: background 0.15s, color 0.2s;
  border-radius: 6px;
}
#leaderboard-list li:hover, #history-list li:hover {
  background: #eafff5b0;
  color: #037d50;
}

/* 13. 차트 컨테이너 ------------------------------------------------------------- */
#chart-container {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: 200px;
}
#history-chart {
  margin-top: 12px;
  background: #f9fff9;
  border-radius: 17px;
  border: 2.7px solid #b4e5c9;
  box-shadow: 0 2px 14px #a7e8ce44;
  width: 100%;
  max-width: 480px;
  min-height: 188px;
}

/* 14. 다크 모드(글래스/네온/섀도우/폰트) ----------------------------------------- */
body.dark {
  background: #161c19 !important;
  color: #ECEFF1 !important;
  background-image: none !important;
}
#container.dark {
  background: #263830e9 !important;
  color: #ECEFF1 !important;
  border-color: #3ed7a5;
  box-shadow: 0 16px 64px #00ffd47d, 0 2px 12px #00d0ff70;
}
#container.dark::before {
  background: linear-gradient(90deg, #31d989 0%, #111 70%);
}
#sample-text.dark {
  background: #21362c !important;
  color: #ECEFF1 !important;
  border-color: #28f2c6;
}
#progress-container.dark { background-color: #33453c !important; border-color: #28f2c6; }
#progress-bar.dark { background: linear-gradient(90deg,#26e47d,#22bfae 80%) !important; }
#typing-area.dark {
  background: #202d27 !important;
  color: #ECEFF1 !important;
  border-color: #17d0a0 !important;
  box-shadow: 0 2px 8px #22bfae33 inset;
}
button.dark, #toggle-mode.dark {
  background: linear-gradient(90deg,#2fbe6b,#26d4b9) !important;
  color: #ECEFF1 !important;
  box-shadow: 0 4px 18px #17d0a044;
}
#leaderboard.dark, #history.dark, #chart-container.dark {
  color: #ECEFF1 !important;
  background: #19211fbb;
  box-shadow: 0 4px 32px #00ffd41a;
}
#leaderboard-list.dark li, #history-list.dark li {
  color: #fff !important;
  background: #144032 !important;
}
#history-chart.dark {
  background: #152320;
  border-color: #00cba6;
}
#stats.dark span { background: #32624c; color: #fff; }

/* 15. 폰트 크기별 스타일 -------------------------------------------------------- */
#typing-area.font-small { font-size: 15px; }
#typing-area.font-medium { font-size: 1.38rem; }
#typing-area.font-large { font-size: 2.1rem; }

/* 16. 반응형/모바일 ------------------------------------------------------------- */
@media (max-width: 1100px) {
  #container { padding: 28px 7px; }
}
@media (max-width: 800px) {
  #container { padding: 9px 0; }
  h1 { font-size: 2.3rem; }
  #settings { flex-direction: column; gap: 0; }
  #sample-text { font-size: 1.1rem; padding: 12px 8px; }
  #stats span { font-size: 1.05rem; }
  button { font-size: 1.09rem; padding: 10px 10px; }
  #typing-area { font-size: 1.11rem; }
}
@media (max-width: 540px) {
  #container { padding: 1px 0; border-radius: 0; }
  #toggle-mode { top: 5px; right: 5px; font-size: 0.93rem; padding: 7px 11px; }
  h1 { font-size: 1.14rem; }
  #sample-text { font-size: 0.99rem; min-height: 60px;}
  #stats { gap: 3px; }
  #stats span { font-size: 0.99rem; padding: 4px 7px;}
  button { font-size: 0.97rem; padding: 7px 7px;}
}

/* 17. 스크롤바 커스텀 ----------------------------------------------------------- */
::-webkit-scrollbar { width: 11px; background: #e0fff4; }
::-webkit-scrollbar-thumb { background: #96f3d1; border-radius: 7px; }
body.dark ::-webkit-scrollbar-thumb { background: #22bfae; }
body.dark ::-webkit-scrollbar { background: #1b2020; }

/* 18. 입력 및 기타 -------------------------------------------------------------- */
input[type="file"] { display: none; }
input[type="text"] {
  border: 2.1px solid #b2dfdb;
  border-radius: 8px;
  padding: 9px 13px;
  font-size: 1.11rem;
  background: #e2fff5;
  transition: border 0.2s;
}
input[type="text"]:focus {
  border: 2.4px solid #22e3ad;
}

/* 19. 애니메이션 및 효과 -------------------------------------------------------- */
@keyframes popIn {
  from { opacity: 0; transform: scale(0.93);}
  to { opacity: 1; transform: scale(1);}
}
.fade-pop { animation: popIn 0.33s cubic-bezier(.16,.64,.47,1.16); }
@media (hover: hover) {
  button:hover, select:hover { filter: brightness(1.05) saturate(1.09);}
}

/* 20. 추가 시각 효과: 카드 글로우, 섀도우, 음영, 라운드 ------------------------ */
.card-glass {
  background: rgba(255,255,255,0.33);
  box-shadow: 0 4px 18px #00ffd41a, 0 1px 4px #fff;
  border-radius: 18px;
  border: 1.5px solid #b2dfdb;
  padding: 18px 22px;
}
.card-glass.neon {
  border: 2.5px solid #00ffd4;
  box-shadow: 0 2px 32px #00ffd455, 0 0 8px #fff4;
}

/* 21. 미니 아이콘, 배지, 마크 --------------------------------------------------- */
.badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 11px;
  background: linear-gradient(90deg,#00e88c33,#fff 80%);
  color: #00996b;
  font-weight: 600;
  font-size: 0.97em;
  margin-left: 9px;
  box-shadow: 0 1px 6px #00ffd41a;
  vertical-align: middle;
}
.badge.critical { background: #ffe6e6; color: #d32f2f; }
.badge.success { background: #d6ffe6; color: #098b4f; }

/* 22. 에러 및 알림 -------------------------------------------------------------- */
.alert {
  background: #ffe6e6;
  color: #d32f2f;
  border: 2px solid #ffcdd2;
  border-radius: 9px;
  padding: 12px 26px;
  margin: 16px 0;
  font-weight: 700;
  box-shadow: 0 3px 14px #ffcdd255;
  text-align: center;
}
.alert.success {
  background: #d6ffe6;
  color: #098b4f;
  border-color: #b9e4c9;
}

/* 23. 모달/팝업 --------------------------------------------------------------- */
.modal {
  position: fixed;
  z-index: 99999;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.35);
  display: flex; justify-content: center; align-items: center;
}
.modal-content {
  background: #fff;
  border-radius: 17px;
  padding: 42px 44px;
  border: 2.5px solid #00ffd4cc;
  box-shadow: 0 7px 32px #00ffd455;
  animation: popIn 0.37s cubic-bezier(.17,.73,.38,1.25);
  min-width: 280px;
}
.modal-content.dark {
  background: #19211f;
  color: #fff;
  border-color: #00ffd4;
}

/* 24. 토스트/짧은 피드백 ------------------------------------------------------- */
.toast {
  position: fixed;
  bottom: 44px; right: 44px;
  z-index: 999999;
  padding: 14px 30px;
  background: #00ffd4;
  color: #111;
  border-radius: 14px;
  font-weight: 900;
  font-size: 1.11rem;
  box-shadow: 0 5px 24px #00ffd488;
  animation: fadein 0.5s;
}

/* (줄수 조정용 공백)
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
.............................................................................................................
...........................................................................................................
*/

/* 25. 마지막: 유틸리티 --------------------------------------------------------- */
.hidden { display: none !important; }
.sr-only { position: absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0);}
.center { display: flex; justify-content: center; align-items: center;}
.w100 { width:100% !important;}
.mt-2 { margin-top: 2px;}
.mt-8 { margin-top: 8px;}
.mb-12 { margin-bottom: 12px;}
.mx-auto { margin-left: auto; margin-right: auto;}
/* 끝 */
  </style>
</head>
<body>
  <!-- 인트로(로딩) 오버레이 -->
  <div id="intro-overlay" style="position:fixed;inset:0;background:rgba(18,34,24,0.97);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <div class="intro-text" style="font-size:4rem;color:#00ffbb;font-family:Orbitron,Nanum Gothic,sans-serif;">초록타자</div>
    <div class="intro-loading" id="loading" style="margin-top:40px;font-size:2.1rem;color:#4cffad;">로딩중...</div>
  </div>
  <!-- 본문 -->
  <button id="toggle-mode">다크 모드</button>
  <div id="container" style="opacity:1;">
    <h1>초록타자 3</h1>
    <div id="settings" style="display:flex;gap:24px;margin-bottom:34px;">
      <div>
        <label for="mode-select">모드 선택:</label>
        <select id="mode-select">
          <option value="unlimited" selected>무제한 모드</option>
          <option value="timed">시간 제한 (60초)</option>
          <option value="error-limit">오류 제한 (3오류)</option>
        </select>
      </div>
      <div>
        <label for="difficulty-select">난이도 선택:</label>
        <select id="difficulty-select">
          <option value="easy" selected>쉬움</option>
          <option value="medium">보통</option>
          <option value="hard">어려움</option>
        </select>
      </div>
      <div>
        <label for="font-size">폰트 크기:</label>
        <select id="font-size">
          <option value="small">작게</option>
          <option value="medium" selected>보통</option>
          <option value="large">크게</option>
        </select>
      </div>
    </div>
    <div id="sample-text"></div>
    <div id="progress-container">
      <div id="progress-bar">0%</div>
    </div>
    <textarea id="typing-area" placeholder="여기에 타자를 입력하세요..."></textarea>
    <div id="stats">
      <span id="timer">시간: 0초</span>
      <span id="wpm">WPM: 0</span>
      <span id="accuracy">정확도: 100%</span>
      <span id="error-count">오류: 0</span>
    </div>
    <button id="reset-btn">새로운 도전</button>
    <button id="export-btn">CSV 내보내기</button>
    <button id="save-progress-btn">진행상황 저장</button>
    <button id="load-progress-btn">진행상황 불러오기</button>
    <input type="file" id="progress-file-input" style="display:none;" accept=".ty">
    <div id="leaderboard">
      <h3>리더보드 (최고 WPM)</h3>
      <ul id="leaderboard-list"></ul>
    </div>
    <div id="chart-container">
      <h3>연습 기록 차트</h3>
      <canvas id="history-chart" width="400" height="200"></canvas>
    </div>
    <div id="history">
      <h3>최근 기록</h3>
      <ul id="history-list"></ul>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- 인트로(로딩) 2초간 보여주기 ---
    window.addEventListener('DOMContentLoaded', function() {
      const intro = document.getElementById('intro-overlay');
      const mainContainer = document.getElementById('container');
      setTimeout(() => {
        intro.classList.add('hide');
        setTimeout(() => {
          intro.style.display = "none";
          mainContainer.style.opacity = 1;
        }, 600);
      }, 2000);
    });

    let currentSentences = [];
    let currentSentenceIndex = 0;
    let currentText = "";
    let overallTypedChars = 0;
    let overallCorrectChars = 0;
    let startTime = null;
    let timerInterval = null;
    let errorCount = 0;
    let isComposing = false;
    let mode = "unlimited";
    const timeLimit = 60;
    const errorLimit = 3;

    const modeSelect = document.getElementById("mode-select");
    const difficultySelect = document.getElementById("difficulty-select");
    const fontSizeSelect = document.getElementById("font-size");
    const typingArea = document.getElementById("typing-area");
    const sampleText = document.getElementById("sample-text");
    const container = document.getElementById("container");
    const toggleBtn = document.getElementById("toggle-mode");

    function applyFontSize() {
      const size = fontSizeSelect.value;
      if(size === "small") typingArea.style.fontSize = "14px";
      else if(size === "medium") typingArea.style.fontSize = "18px";
      else if(size === "large") typingArea.style.fontSize = "23px";
    }
    fontSizeSelect.addEventListener("change", applyFontSize);

    modeSelect.addEventListener("change", () => {
      mode = modeSelect.value;
      loadNewText();
    });
    difficultySelect.addEventListener("change", loadNewText);

    const allSentences = [
      "오늘 아침 공기는 상쾌하다.",
      "따스한 햇살이 창문을 비춘다.",
      "커피 한 잔의 여유를 즐겨보자.",
      "바쁜 하루 속에서도 작은 쉼표가 필요하다.",
      "책 한 권과 따뜻한 차가 최고의 조합이다.",
      "자연은 언제나 우리에게 영감을 준다.",
      "친구와의 대화는 마음의 에너지를 충전시킨다.",
      "도전은 새로운 가능성의 시작이다.",
      "꿈은 노력하는 사람의 발걸음을 이끈다.",
      "작은 변화가 큰 결과를 만든다.",
      "행복은 스스로 만들어 가는 것이다.",
      "웃음은 마음을 치유하는 마법이다.",
      "시간은 누구에게나 공평하게 주어진다.",
      "진정한 우정은 오랜 시간이 지나도 변하지 않는다.",
      "학습은 평생 동안 계속되어야 한다.",
      "자신감을 가지고 도전에 임하라.",
      "오늘은 내일보다 더 특별한 날이다.",
      "긍정적인 생각이 인생을 바꾼다.",
      "성공은 준비된 자에게 찾아온다.",
      "노력은 결코 배신하지 않는다.",
      "실패는 성공을 위한 발판이다.",
      "끊임없는 열정이 최고의 성과를 이끈다.",
      "용기는 두려움을 이기는 힘이다.",
      "매일 반복되는 일상 속에도 소중한 순간이 있다.",
      "희망은 어둠 속에서 빛나는 별이다.",
      "도전 정신은 미래를 열어준다.",
      "작은 성취가 큰 자신감을 불러온다.",
      "꾸준한 연습은 반드시 결실을 맺는다.",
      "현재의 노력이 내일의 꿈을 현실로 만든다.",
      "자신의 한계를 넘어서기 위해 노력하라.",
      "매 순간 최선을 다하는 것이 중요하다.",
      "인내는 승리의 열쇠이다.",
      "배움에는 끝이 없다.",
      "새로운 시작은 언제나 설렘으로 가득하다.",
      "변화는 도전을 두려워하지 않은 자의 것이다.",
      "함께라면 어려움도 이겨낼 수 있다.",
      "열린 마음이 새로운 기회를 만든다.",
      "자연의 소리에 귀 기울여 보자.",
      "조용한 아침 산책은 마음의 안식을 준다.",
      "별을 바라보며 꿈을 꾸자.",
      "매일 조금씩 발전하는 나를 느낀다.",
      "노력이 쌓이면 큰 성과를 이룬다.",
      "정직함은 최고의 미덕이다.",
      "사랑은 모든 것을 극복한다.",
      "작은 친절이 큰 기적을 만든다.",
      "의지력이 강한 사람은 반드시 성공한다.",
      "매 순간을 소중히 여기자.",
      "시간은 우리 모두에게 주어진 귀한 자원이다.",
      "서로의 다름을 인정하는 것이 성숙이다.",
      "자연을 보호하는 것은 우리의 책임이다.",
      "과거는 배움의 원천이다.",
      "오늘의 노력은 내일의 보상이다.",
      "노력과 끈기는 최고의 동반자이다.",
      "긍정적인 에너지가 주변을 밝혀준다.",
      "작은 목표가 큰 꿈으로 이어진다.",
      "미래는 현명하게 준비한 사람의 것이다.",
      "배움에 대한 열정은 마음의 불씨이다.",
      "시간을 소중히 여기며 생활하자.",
      "희망은 모든 어려움을 극복하게 해준다.",
      "매일 아침 새로운 기회가 주어진다.",
      "열심히 일한 보람을 느껴보자.",
      "자신만의 길을 걸으며 꿈을 향해 나아가자.",
      "성공은 작은 습관의 반복이다.",
      "자연의 아름다움에 감탄하며 살아가자.",
      "모든 순간이 인생의 귀중한 기록이다.",
      "내일은 오늘보다 더 빛날 것이다.",
      "마음의 여유를 가지며 살아가자.",
      "작은 용기가 큰 변화를 만든다.",
      "서로를 존중하는 사회가 되자."
    ];

    function getRandomSentences() {
      let shuffled = allSentences.slice().sort(() => Math.random() - 0.5);
      return shuffled.slice(0, 10);
    }

    // *** 버그 없는 띄어쓰기 하이라이트 ***
    function resetHighlights() {
      // 공백은 &nbsp;로 바꿔서 span으로 감싸기
      sampleText.innerHTML = currentText.split("").map(letter =>
        letter === " " ? `<span>&nbsp;</span>` : `<span>${letter}</span>`
      ).join("");
      sampleText.classList.remove("fade-in");
      void sampleText.offsetWidth;
      sampleText.classList.add("fade-in");
    }

    function resetStats() {
      document.getElementById("error-count").textContent = "오류: 0";
      errorCount = 0;
    }

    function updateProgressBar() {
      const progressBar = document.getElementById("progress-bar");
      const percentage = Math.round((currentSentenceIndex / currentSentences.length) * 100);
      progressBar.style.width = percentage + "%";
      progressBar.textContent = percentage + "%";
    }

    let leaderboard = [];
    let historyResults = [];
    try {
      leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
    } catch (e) { leaderboard = []; }
    try {
      historyResults = JSON.parse(localStorage.getItem("typingHistory")) || [];
    } catch (e) { historyResults = []; }

    function updateLeaderboard(newResult) {
      leaderboard.push(newResult);
      leaderboard.sort((a, b) => b.wpm - a.wpm);
      leaderboard = leaderboard.slice(0, 5);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const leaderboardList = document.getElementById("leaderboard-list");
      leaderboardList.innerHTML = "";
      leaderboard.forEach((entry, index) => {
        const li = document.createElement("li");
        li.textContent = `#${index + 1}: WPM ${entry.wpm}, 정확도 ${entry.accuracy}%, 오류 ${entry.errorCount}`;
        leaderboardList.appendChild(li);
      });
      leaderboardList.classList.toggle("dark", darkMode);
    }

    function saveResult(result) {
      historyResults.push(result);
      localStorage.setItem("typingHistory", JSON.stringify(historyResults));
      renderHistory();
      updateChart();
      updateLeaderboard(result);
    }

    function renderHistory() {
      const historyList = document.getElementById("history-list");
      historyList.innerHTML = "";
      historyResults.slice().reverse().forEach((result, index) => {
        const li = document.createElement("li");
        li.textContent = `도전 ${historyResults.length - index}: 시간 ${result.time}초, WPM ${result.wpm}, 정확도 ${result.accuracy}%, 오류 ${result.errorCount}`;
        historyList.appendChild(li);
      });
      historyList.classList.toggle("dark", darkMode);
    }

    function playErrorSound() {
      if (window.errorSoundCtx && window.errorSoundCtx.state !== 'closed') {
        window.errorSoundCtx.close();
      }
      window.errorSoundCtx = new (window.AudioContext || window.webkitAudioContext)();
      const context = window.errorSoundCtx;
      const oscillator = context.createOscillator();
      oscillator.type = "sine";
      oscillator.frequency.setValueAtTime(440, context.currentTime);
      oscillator.connect(context.destination);
      oscillator.start();
      setTimeout(() => {
        oscillator.stop();
        oscillator.disconnect();
        context.close();
      }, 100);
    }

    function updateHighlight() {
      const typed = typingArea.value;
      const spans = sampleText.querySelectorAll("span");
      let localErrorCount = 0;
      let playedErrorSound = false;
      spans.forEach((span, i) => {
        const letter = typed[i];
        // 띄어쓰기: span.innerHTML이 '&nbsp;'일 수도 있음 → 실제 비교는 span.textContent
        if(letter == null) {
          span.classList.remove("highlight");
        } else if(letter === (span.textContent || " ")) {
          span.classList.remove("highlight");
        } else {
          if(!span.classList.contains("highlight")) {
            if (!playedErrorSound) {
              playErrorSound();
              playedErrorSound = true;
            }
          }
          span.classList.add("highlight");
          localErrorCount++;
        }
      });
      errorCount = localErrorCount;
      document.getElementById("error-count").textContent = "오류: " + errorCount;
      if(mode === "error-limit" && errorCount >= errorLimit)
        finishChallenge();
    }

    function calculateStats() {
      const currentTyped = typingArea.value;
      let currentCorrect = 0;
      for(let i = 0; i < currentTyped.length; i++) {
        if(currentTyped[i] === currentText[i]) currentCorrect++;
      }
      let totalTyped = overallTypedChars + currentTyped.length;
      let totalCorrect = overallCorrectChars + currentCorrect;
      const elapsedTime = (Date.now() - startTime) / 1000;
      const wpm = elapsedTime > 0 ? Math.round((totalTyped / 5) / (elapsedTime / 60)) : 0;
      const accuracy = totalTyped === 0 ? 100 : Math.round((totalCorrect / totalTyped) * 100);
      document.getElementById("timer").textContent = "시간: " + Math.floor(elapsedTime) + "초";
      document.getElementById("wpm").textContent = "WPM: " + wpm;
      document.getElementById("accuracy").textContent = "정확도: " + accuracy + "%";
      document.getElementById("error-count").textContent = "오류: " + errorCount;
      if(mode === "timed" && elapsedTime >= timeLimit)
        finishChallenge();
    }

    function finishChallenge() {
      if (typingArea.disabled) return;
      clearInterval(timerInterval);
      timerInterval = null;
      const currentTyped = typingArea.value;
      let currentCorrect = 0;
      for(let i = 0; i < currentTyped.length; i++) {
        if(currentTyped[i] === currentText[i]) currentCorrect++;
      }
      let finalTyped = overallTypedChars + currentTyped.length;
      let finalCorrect = overallCorrectChars + currentCorrect;
      const elapsedTime = (Date.now() - startTime) / 1000;
      const wpm = elapsedTime > 0 ? Math.round((finalTyped / 5) / (elapsedTime / 60)) : 0;
      const accuracy = finalTyped === 0 ? 100 : Math.round((finalCorrect / finalTyped) * 100);
      typingArea.disabled = true;
      updateProgressBar();
      const result = {
        time: Math.floor(elapsedTime),
        wpm: wpm,
        accuracy: accuracy,
        errorCount: errorCount,
        sentences: currentSentences,
        mode: mode,
        timestamp: new Date().toISOString()
      };
      saveResult(result);
    }

    function startTimer() {
      if(!startTime && !timerInterval) {
        startTime = Date.now();
        timerInterval = setInterval(calculateStats, 1000);
      }
    }

    function loadNewText() {
      currentSentences = getRandomSentences();
      currentSentenceIndex = 0;
      currentText = currentSentences[currentSentenceIndex];
      overallTypedChars = 0;
      overallCorrectChars = 0;
      sampleText.innerHTML = "";
      resetHighlights();
      typingArea.value = "";
      typingArea.disabled = false;
      resetStats();
      clearInterval(timerInterval);
      timerInterval = null;
      startTime = null;
      updateProgressBar();
      document.getElementById("timer").textContent = "시간: 0초";
      document.getElementById("wpm").textContent = "WPM: 0";
      document.getElementById("accuracy").textContent = "정확도: 100%";
      resetHighlights();
    }

    function exportCSV() {
      if(!historyResults.length) return;
      let csvContent = "\uFEFF";
      csvContent += "시간(초),WPM,정확도(%),오류,모드,문장들,타임스탬프\n";
      historyResults.forEach(result => {
        const safeTimestamp = result.timestamp ? result.timestamp : '';
        csvContent += `"${result.time}","${result.wpm}","${result.accuracy}","${result.errorCount}","${result.mode.replace(/"/g, '""')}","${(result.sentences||[]).join(" | ").replace(/"/g, '""')}","${safeTimestamp}"\n`;
      });
      const encodedUri = "data:text/csv;charset=utf-8," + encodeURIComponent(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "typing_history.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    document.getElementById("save-progress-btn").addEventListener("click", function() {
      const progress = {
        currentSentences,
        currentSentenceIndex,
        currentText,
        overallTypedChars,
        overallCorrectChars,
        startTime,
        errorCount,
        mode,
        typingValue: typingArea.value,
        darkMode
      };
      const blob = new Blob([JSON.stringify(progress)], { type: "application/json" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "진행상황.ty";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    document.getElementById("load-progress-btn").addEventListener("click", function() {
      document.getElementById("progress-file-input").click();
    });
    document.getElementById("progress-file-input").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        try {
          const progress = JSON.parse(ev.target.result);
          currentSentences = progress.currentSentences || [];
          currentSentenceIndex = progress.currentSentenceIndex || 0;
          currentText = progress.currentText || "";
          overallTypedChars = progress.overallTypedChars || 0;
          overallCorrectChars = progress.overallCorrectChars || 0;
          startTime = progress.startTime || null;
          errorCount = progress.errorCount || 0;
          mode = progress.mode || "unlimited";
          typingArea.value = progress.typingValue || "";
          darkMode = progress.darkMode || false;

          modeSelect.value = mode;
          resetHighlights();
          updateProgressBar();
          resetStats();
          updateHighlight();
          calculateStats();
          typingArea.disabled = false;
          if (darkMode) setDarkMode(true); else setDarkMode(false);
        } catch (err) {
          alert("진행상황 파일이 올바르지 않습니다!");
        }
      };
      reader.readAsText(file, "utf-8");
    });

    let chart;
    function updateChart() {
      const chartEl = document.getElementById("history-chart");
      if (!chartEl) return;
      const ctx = chartEl.getContext("2d");
      const labels = historyResults.map(result => {
        if (result.timestamp) {
          try {
            return new Date(result.timestamp).toLocaleTimeString();
          } catch (e) {
            return '';
          }
        }
        return '';
      });
      const dataWpm = historyResults.map(result => result.wpm);
      if(chart) {
        chart.destroy();
      }
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'WPM 추이',
            data: dataWpm,
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.14)',
            fill: true,
            pointBackgroundColor: '#00bc88',
            tension: 0.2,
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    let darkMode = false;
    function setDarkMode(on) {
      darkMode = on;
      document.body.classList.toggle("dark", darkMode);
      container.classList.toggle("dark", darkMode);
      sampleText.classList.toggle("dark", darkMode);
      document.getElementById("progress-container").classList.toggle("dark", darkMode);
      document.getElementById("progress-bar").classList.toggle("dark", darkMode);
      typingArea.classList.toggle("dark", darkMode);
      toggleBtn.classList.toggle("dark", darkMode);
      document.getElementById("leaderboard").classList.toggle("dark", darkMode);
      document.getElementById("history").classList.toggle("dark", darkMode);
      document.getElementById("chart-container").classList.toggle("dark", darkMode);
      renderLeaderboard();
      renderHistory();
      toggleBtn.textContent = darkMode ? "라이트 모드" : "다크 모드";
    }
    function toggleMode() { setDarkMode(!darkMode); }
    toggleBtn.addEventListener("click", toggleMode);

    typingArea.addEventListener("compositionstart", () => { isComposing = true; });
    typingArea.addEventListener("compositionend", () => {
      isComposing = false; updateHighlight(); calculateStats();
    });
    typingArea.addEventListener("input", () => {
      if (!isComposing) {
        if(!startTime) startTimer();
        updateHighlight();
        calculateStats();
      } else {
        if(!startTime) startTimer();
      }
    });
    typingArea.addEventListener("keydown", (event) => {
      if(isComposing) return;
      if(event.key === "Enter") {
        event.preventDefault();
        let typed = typingArea.value;
        if(typed === currentText) {
          overallTypedChars += currentText.length;
          overallCorrectChars += currentText.length;
          currentSentenceIndex++;
          updateProgressBar();
          if(currentSentenceIndex < currentSentences.length) {
            currentText = currentSentences[currentSentenceIndex];
            sampleText.innerHTML = "";
            resetHighlights();
            typingArea.value = "";
            resetStats();
          } else {
            finishChallenge();
          }
        } else {
          playErrorSound();
        }
      }
    });

    document.getElementById("reset-btn").addEventListener("click", loadNewText);
    document.getElementById("export-btn").addEventListener("click", exportCSV);

    // 초기화
    loadNewText();
    renderHistory();
    renderLeaderboard();
    updateChart();
    applyFontSize();
  </script>
</body>
</html>
